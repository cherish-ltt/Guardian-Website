# 

<div align="center">
  <h1>Guardian Auth API v1.0</h1>
  <p>
  <a href="https://img.shields.io/badge/version-v1.0-blue.svg">
    <img src="https://img.shields.io/badge/version-v1.0-blue.svg" alt="license"/>
  </a>
  <a href="https://img.shields.io/badge/status-stable-green.svg">
    <img src="https://img.shields.io/badge/status-stable-green.svg" alt="license"/>
  </a>
  </p>
</div>
  

å®Œæ•´çš„ Guardian è®¤è¯ç³»ç»Ÿ API æ–‡æ¡£ã€‚

## ğŸ“‹ ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [è®¤è¯æ–¹å¼](#è®¤è¯æ–¹å¼)
- [é€šç”¨å“åº”æ ¼å¼](#é€šç”¨å“åº”æ ¼å¼)
- [è®¤è¯æ¥å£](#è®¤è¯æ¥å£)
- [ç®¡ç†å‘˜æ¥å£](#ç®¡ç†å‘˜æ¥å£-å¾…å®ç°)
- [è§’è‰²æ¥å£](#è§’è‰²æ¥å£-å¾…å®ç°)
- [æƒé™æ¥å£](#æƒé™æ¥å£-å¾…å®ç°)
- [é”™è¯¯ç ](#é”™è¯¯ç )

---

## æ¦‚è¿°

Guardian API v1.0 æä¾›äº†å®Œæ•´çš„ç”¨æˆ·è®¤è¯ã€æƒé™ç®¡ç†å’Œæ“ä½œå®¡è®¡åŠŸèƒ½ã€‚

**Base URL**: `http://localhost:6123/guardian-auth/v1`

**Content-Type**: `application/json`

**å­—ç¬¦ç¼–ç **: `UTF-8`

---

## è®¤è¯æ–¹å¼

### JWT è®¤è¯

å¯¹äºéœ€è¦è®¤è¯çš„æ¥å£ï¼Œä½¿ç”¨ `Authorization` è¯·æ±‚å¤´ï¼š

```
Authorization: Bearer <access_token>
```

**ä»¤ç‰Œè¯´æ˜**:
- **Access Token**: æœ‰æ•ˆæœŸ 15 åˆ†é’Ÿï¼Œç”¨äºè®¿é—®å—ä¿æŠ¤æ¥å£
- **Refresh Token**: æœ‰æ•ˆæœŸ 7 å¤©ï¼Œç”¨äºåˆ·æ–° Access Token

---

## é€šç”¨å“åº”æ ¼å¼

æ‰€æœ‰æ¥å£è¿”å›ç»Ÿä¸€æ ¼å¼çš„ JSONï¼š

```json
{
  "code": 200,           // ä¸šåŠ¡çŠ¶æ€ç ï¼Œ200 è¡¨ç¤ºæˆåŠŸ
  "msg": "æ“ä½œæˆåŠŸ",      // æ¶ˆæ¯æè¿°ï¼Œå¯ä¸º null
  "data": { ... },         // å“åº”æ•°æ®ï¼ŒæˆåŠŸæ—¶åŒ…å«
  "timestamp": 1700000000000  // æ—¶é—´æˆ³ï¼ˆéƒ¨åˆ†æ¥å£åŒ…å«ï¼‰
}
```

### æˆåŠŸå“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "msg": null,
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 900
  }
}
```

### å¤±è´¥å“åº”ç¤ºä¾‹

```json
{
  "code": 17002,
  "msg": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯",
  "data": null
}
```

---

## è®¤è¯æ¥å£

### ç”¨æˆ·ç™»å½•

**æ¥å£æè¿°**: ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ç™»å½•ç³»ç»Ÿï¼Œè·å–è®¿é—®ä»¤ç‰Œ

**è¯·æ±‚æ–¹å¼**: `POST`

**è¯·æ±‚è·¯å¾„**: `/auth/login`

**è¯·æ±‚å¤´**:
```
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|--------|------|
| username | string | æ˜¯ | ç”¨æˆ·å |
| password | string | æ˜¯ | å¯†ç  |
| two_fa_code | string | å¦ | 2FAéªŒè¯ç ï¼ˆå¦‚æœè´¦æˆ·å¯ç”¨äº†2FAï¼Œæ­¤å‚æ•°å¿…å¡«ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X POST http://localhost:6123/guardian-auth/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "123456"
  }'
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "msg": null,
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 900
  }
}
```

**é”™è¯¯å“åº”ç¤ºä¾‹**:

```json
{
  "code": 17002,
  "msg": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯",
  "data": null
}
```

---

### åˆ·æ–°ä»¤ç‰Œ

**æ¥å£æè¿°**: ä½¿ç”¨ refresh token è·å–æ–°çš„ access token

**è¯·æ±‚æ–¹å¼**: `POST`

**è¯·æ±‚è·¯å¾„**: `/auth/refresh`

**è¯·æ±‚å¤´**:
```
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|--------|------|
| refresh_token | string | æ˜¯ | åˆ·æ–°ä»¤ç‰Œ |

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X POST http://localhost:6123/guardian-auth/v1/auth/refresh \
  -H "Content-Type: application/json" \
  -d '{
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }'
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "msg": null,
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 900
  }
}
```

---

### ç”¨æˆ·ç™»å‡º

**æ¥å£æè¿°**: ç™»å‡ºç³»ç»Ÿï¼Œä½¿ refresh token å¤±æ•ˆ

**è¯·æ±‚æ–¹å¼**: `POST`

**è¯·æ±‚è·¯å¾„**: `/auth/logout`

**è®¤è¯**: éœ€è¦ JWT

**è¯·æ±‚å¤´**:
```
Content-Type: application/json
Authorization: Bearer <access_token>
```

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|--------|------|
| refresh_token | string | æ˜¯ | è¦å¤±æ•ˆçš„åˆ·æ–°ä»¤ç‰Œ |

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X POST http://localhost:6123/guardian-auth/v1/auth/logout \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <access_token>" \
  -d '{
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }'
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "msg": null,
  "data": null
}
```

---

### è®¾ç½®2FA

**æ¥å£æè¿°**: ä¸ºå½“å‰è´¦æˆ·å¯ç”¨åŒå› ç´ è®¤è¯ï¼ˆ2FAï¼‰

**è¯·æ±‚æ–¹å¼**: `POST`

**è¯·æ±‚è·¯å¾„**: `/auth/2fa/setup`

**è®¤è¯**: éœ€è¦ JWT

**è¯·æ±‚å¤´**:
```
Authorization: Bearer <access_token>
```

**è¯·æ±‚å‚æ•°**: æ— ï¼ˆä½¿ç”¨ JWT ä¸­çš„ç”¨æˆ·ä¿¡æ¯ï¼‰

**å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "msg": null,
  "data": {
    "secret": "JBSWY3DPEHPK3PXP",
    "qr_code_url": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...",
    "backup_codes": [
      "12345678",
      "23456789",
      "34567890",
      "45678901",
      "56789012",
      "67890123",
      "78901234",
      "89012345",
      "90123456",
      "01234567"
    ]
  }
}
```

**ä¸šåŠ¡è§„åˆ™**:
- æ¯ä¸ªè´¦æˆ·åªèƒ½è®¾ç½®ä¸€æ¬¡ 2FA
- å¦‚æœå·²ç»å¯ç”¨ 2FAï¼Œä¼šè¿”å›é”™è¯¯ï¼ˆ17010: å·²å¯ç”¨2FAï¼‰
- å“åº”åŒ…å« TOTP å¯†é’¥ã€äºŒç»´ç å’Œ10ä¸ªå¤‡ç”¨éªŒè¯ç 
- è¯·å¦¥å–„ä¿å­˜å¤‡ç”¨éªŒè¯ç ï¼Œæ¯ä¸ªéªŒè¯ç åªèƒ½ä½¿ç”¨ä¸€æ¬¡

---

### éªŒè¯2FA

**æ¥å£æè¿°**: éªŒè¯ç”¨æˆ·è¾“å…¥çš„2FAéªŒè¯ç æ˜¯å¦æ­£ç¡®

**è¯·æ±‚æ–¹å¼**: `POST`

**è¯·æ±‚è·¯å¾„**: `/auth/2fa/verify`

**è®¤è¯**: éœ€è¦ JWT

**è¯·æ±‚å¤´**:
```
Content-Type: application/json
Authorization: Bearer <access_token>
```

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|--------|------|
| code | string | æ˜¯ | 6ä½æ•°å­—çš„ TOTP éªŒè¯ç  |

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X POST http://localhost:6123/guardian-auth/v1/auth/2fa/verify \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <access_token>" \
  -d '{
    "code": "123456"
  }'
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "msg": null,
  "data": {
    "verified": true
  }
}
```

**é”™è¯¯å“åº”ç¤ºä¾‹**:

```json
{
  "code": 17008,
  "msg": "æ— æ•ˆçš„2FAéªŒè¯ç ",
  "data": null
}
```

**ä¸šåŠ¡è§„åˆ™**:
- å¦‚æœæœªå¯ç”¨ 2FAï¼Œä¼šè¿”å›é”™è¯¯ï¼ˆ17009: æœªå¯ç”¨2FAï¼‰
- éªŒè¯ç æœ‰æ•ˆæœŸä¸º 30 ç§’
- éªŒè¯å¤±è´¥ä¸ä¼šé”å®šè´¦æˆ·

---

## ç®¡ç†å‘˜æ¥å£

> âš ï¸ **æ³¨æ„**: ä»¥ä¸‹æ¥å£å·²å®šä¹‰ DTO ä½†å°šæœªåœ¨ router.rs ä¸­å®ç°è·¯ç”±

### æŸ¥è¯¢ç®¡ç†å‘˜åˆ—è¡¨

**æ¥å£æè¿°**: åˆ†é¡µæŸ¥è¯¢ç®¡ç†å‘˜åˆ—è¡¨

**è¯·æ±‚æ–¹å¼**: `GET`

**è¯·æ±‚è·¯å¾„**: `/admins`

**è®¤è¯**: éœ€è¦ JWT

**æŸ¥è¯¢å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|--------|------|
| page | number | å¦ | 1 | é¡µç  |
| page_size | number | å¦ | 20 | æ¯é¡µæ•°é‡ |
| status | number | å¦ | - | çŠ¶æ€ç­›é€‰ï¼ˆ1-æ­£å¸¸ï¼Œ0-ç¦ç”¨ï¼‰ |
| keyword | string | å¦ | - | ç”¨æˆ·åå…³é”®å­—æœç´¢ |

**è¯·æ±‚ç¤ºä¾‹**:

```
GET /guardian-auth/v1/admins?page=1&page_size=20&status=1
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "msg": null,
  "data": {
    "total": 100,
    "page": 1,
    "page_size": 20,
    "list": [
      {
        "id": "0190a1e8-7b3e-7a3f-8c1a-9e2f3a4b5c6d",
        "username": "admin",
        "is_super_admin": true,
        "status": 1,
        "last_login_at": "2024-01-01T10:30:00Z",
        "created_at": "2023-12-01T00:00:00Z"
      }
    ]
  }
}
```

---

### è·å–ç®¡ç†å‘˜è¯¦æƒ…

**æ¥å£æè¿°**: è·å–æŒ‡å®šç®¡ç†å‘˜çš„è¯¦ç»†ä¿¡æ¯

**è¯·æ±‚æ–¹å¼**: `GET`

**è¯·æ±‚è·¯å¾„**: `/admins/:id`

**è®¤è¯**: éœ€è¦ JWT

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|--------|------|
| id | string(UUID) | æ˜¯ | ç®¡ç†å‘˜ ID |

**è¯·æ±‚ç¤ºä¾‹**:

```
GET /guardian-auth/v1/admins/0190a1e8-7b3e-7a3f-8c1a-9e2f3a4b5c6d
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "msg": null,
  "data": {
    "id": "0190a1e8-7b3e-7a3f-8c1a-9e2f3a4b5c6d",
    "username": "admin",
    "is_super_admin": true,
    "status": 1,
    "last_login_at": "2024-01-01T10:30:00Z",
    "login_attempts": 0,
    "locked_until": null,
    "created_at": "2023-12-01T00:00:00Z",
    "updated_at": "2024-01-01T12:00:00Z"
  }
}
```

---

### åˆ›å»ºç®¡ç†å‘˜

**æ¥å£æè¿°**: åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦å·

**è¯·æ±‚æ–¹å¼**: `POST`

**è¯·æ±‚è·¯å¾„**: `/admins`

**è®¤è¯**: éœ€è¦ JWT

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|--------|------|
| username | string | æ˜¯ | ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰ |
| password | string | æ˜¯ | å¯†ç ï¼ˆæ˜æ–‡ï¼Œå°†è¿›è¡Œ Argon2 å“ˆå¸Œï¼‰ |
| is_super_admin | boolean | å¦ | æ˜¯å¦ä¸ºè¶…çº§ç®¡ç†å‘˜ï¼ˆé»˜è®¤ falseï¼‰ |
| role_ids | array | å¦ | å…³è”çš„è§’è‰² ID æ•°ç»„ï¼ˆUUIDï¼‰ |

**è¯·æ±‚ç¤ºä¾‹**:

```json
{
  "username": "newadmin",
  "password": "SecurePass123",
  "is_super_admin": false,
  "role_ids": ["0190a1e8-7b3e-7a3f-8c1a-9e2f3a4b5c6d"]
}
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "msg": "åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": "0190b2f9-8c4f-8b4g-9d2b-0f3g4b5c6d7e",
    "username": "newadmin",
    "is_super_admin": false,
    "status": 1,
    "created_at": "2024-01-01T12:00:00Z"
  }
}
```

---

### æ›´æ–°ç®¡ç†å‘˜

**æ¥å£æè¿°**: æ›´æ–°ç®¡ç†å‘˜ä¿¡æ¯

**è¯·æ±‚æ–¹å¼**: `PUT`

**è¯·æ±‚è·¯å¾„**: `/admins/:id`

**è®¤è¯**: éœ€è¦ JWT

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|--------|------|
| id | string(UUID) | æ˜¯ | ç®¡ç†å‘˜ ID |

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|--------|------|
| password | string | å¦ | æ–°å¯†ç ï¼ˆå°†è¿›è¡Œ Argon2 å“ˆå¸Œï¼‰ |
| status | number | å¦ | çŠ¶æ€ï¼ˆ1-æ­£å¸¸ï¼Œ0-ç¦ç”¨ï¼‰ |
| role_ids | array | å¦ | å…³è”çš„è§’è‰² ID æ•°ç»„ï¼ˆUUIDï¼‰ |

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X PUT http://localhost:6123/guardian-auth/v1/admins/0190a1e8-7b3e-7a3f-8c1a-9e2f3a4b5c6d \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <access_token>" \
  -d '{
    "status": 0,
    "role_ids": ["0190a1e8-7b3e-7a3f-8c1a-9e2f3a4b5c6d", "0190b2f9-8c4f-8b4g-9d2b-0f3g4b5c6d7e"]
  }'
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "msg": "æ›´æ–°æˆåŠŸ",
  "data": {
    "id": "0190a1e8-7b3e-7a3f-8c1a-9e2f3a4b5c6d",
    "username": "admin",
    "status": 0,
    "updated_at": "2024-01-01T12:00:00Z"
  }
}
```

---

### åˆ é™¤ç®¡ç†å‘˜

**æ¥å£æè¿°**: åˆ é™¤æŒ‡å®šçš„ç®¡ç†å‘˜è´¦å·

**è¯·æ±‚æ–¹å¼**: `DELETE`

**è¯·æ±‚è·¯å¾„**: `/admins/:id`

**è®¤è¯**: éœ€è¦ JWT

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|--------|------|
| id | string(UUID) | æ˜¯ | è¦åˆ é™¤çš„ç®¡ç†å‘˜ ID |

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X DELETE http://localhost:6123/guardian-auth/v1/admins/0190a1e8-7b3e-7a3f-8c1a-9e2f3a4b5c6d \
  -H "Authorization: Bearer <access_token>"
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "msg": "åˆ é™¤æˆåŠŸ",
  "data": null
}
```

---

## è§’è‰²æ¥å£

> âš ï¸ **æ³¨æ„**: ä»¥ä¸‹æ¥å£å·²å®šä¹‰ DTO ä½†å°šæœªåœ¨ router.rs ä¸­å®ç°è·¯ç”±

### åˆ›å»ºè§’è‰²

**æ¥å£æè¿°**: åˆ›å»ºæ–°çš„è§’è‰²

**è¯·æ±‚æ–¹å¼**: `POST`

**è¯·æ±‚è·¯å¾„**: `/roles`

**è®¤è¯**: éœ€è¦ JWT

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|--------|------|
| code | string | æ˜¯ | è§’è‰²ä»£ç ï¼ˆå”¯ä¸€ï¼Œå¦‚ "admin", "editor"ï¼‰ |
| name | string | æ˜¯ | è§’è‰²åç§° |
| description | string | å¦ | è§’è‰²æè¿° |
| permission_ids | array | å¦ | å…³è”çš„æƒé™ ID æ•°ç»„ |

**è¯·æ±‚ç¤ºä¾‹**:

```json
{
  "code": "editor",
  "name": "å†…å®¹ç¼–è¾‘å™¨",
  "description": "å¯ä»¥ç¼–è¾‘å†…å®¹çš„æƒé™",
  "permission_ids": ["0190a1e8-7b3e-7a3f-8c1a-9e2f3a4b5c6d", "0190b2f9-8c4f-8b4g-9d2b-0f3g4b5c6d7e"]
}
```

---

### æŸ¥è¯¢è§’è‰²åˆ—è¡¨

**æ¥å£æè¿°**: æŸ¥è¯¢æ‰€æœ‰è§’è‰²

**è¯·æ±‚æ–¹å¼**: `GET`

**è¯·æ±‚è·¯å¾„**: `/roles`

**è®¤è¯**: éœ€è¦ JWT

**æŸ¥è¯¢å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|--------|------|
| page | number | å¦ | 1 | é¡µç  |
| page_size | number | å¦ | 20 | æ¯é¡µæ•°é‡ |
| keyword | string | å¦ | - | è§’è‰²åæˆ–ä»£ç å…³é”®å­—æœç´¢ |

**è¯·æ±‚ç¤ºä¾‹**:

```
GET /guardian-auth/v1/roles?page=1&page_size=20
```

---

### è·å–è§’è‰²è¯¦æƒ…

**æ¥å£æè¿°**: è·å–è§’è‰²çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…³è”çš„æƒé™

**è¯·æ±‚æ–¹å¼**: `GET`

**è¯·æ±‚è·¯å¾„**: `/roles/:id`

**è®¤è¯**: éœ€è¦ JWT

**è¯·æ±‚ç¤ºä¾‹**:

```
GET /guardian-auth/v1/roles/0190a1e8-7b3e-7a3f-8c1a-9e2f3a4b5c6d
```

---

### æ›´æ–°è§’è‰²

**æ¥å£æè¿°**: æ›´æ–°è§’è‰²ä¿¡æ¯

**è¯·æ±‚æ–¹å¼**: `PUT`

**è¯·æ±‚è·¯å¾„**: `/roles/:id`

**è®¤è¯**: éœ€è¦ JWT

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|--------|------|
| name | string | å¦ | è§’è‰²åç§° |
| description | string | å¦ | è§’è‰²æè¿° |
| permission_ids | array | å¦ | å…³è”çš„æƒé™ ID æ•°ç»„ï¼ˆå…¨é‡æ›¿æ¢ï¼‰ |

---

### åˆ é™¤è§’è‰²

**æ¥å£æè¿°**: åˆ é™¤æŒ‡å®šçš„è§’è‰²

**è¯·æ±‚æ–¹å¼**: `DELETE`

**è¯·æ±‚è·¯å¾„**: `/roles/:id`

**è®¤è¯**: éœ€è¦ JWT

**ä¸šåŠ¡è§„åˆ™**:
- ä¸èƒ½åˆ é™¤ç³»ç»Ÿå†…ç½®è§’è‰²ï¼ˆ`is_system = true`ï¼‰
- åˆ é™¤è§’è‰²å‰éœ€è¦è§£é™¤ç®¡ç†å‘˜å…³è”

---

### åˆ†é…æƒé™

**æ¥å£æè¿°**: ä¸ºè§’è‰²åˆ†é…æƒé™

**è¯·æ±‚æ–¹å¼**: `POST`

**è¯·æ±‚è·¯å¾„**: `/roles/:id/permissions`

**è®¤è¯**: éœ€è¦ JWT

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|--------|------|
| permission_ids | array | æ˜¯ | è¦åˆ†é…çš„æƒé™ ID æ•°ç»„ï¼ˆå…¨é‡æ›¿æ¢ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹**:

```json
{
  "permission_ids": ["0190a1e8-7b3e-7a3f-8c1a-9e2f3a4b5c6d", "0190b2f9-8c4f-8b4g-9d2b-0f3g4b5c6d7e", "0190c3g0-9d5g-9c5h-0e3c-1g4h5c6d7e8f"]
}
```

---

## æƒé™æ¥å£

> âš ï¸ **æ³¨æ„**: ä»¥ä¸‹æ¥å£å·²å®šä¹‰ DTO ä½†å°šæœªåœ¨ router.rs ä¸­å®ç°è·¯ç”±

### è·å–æƒé™æ ‘

**æ¥å£æè¿°**: è·å–æƒé™çš„æ ‘å½¢ç»“æ„

**è¯·æ±‚æ–¹å¼**: `GET`

**è¯·æ±‚è·¯å¾„**: `/permissions/tree`

**è®¤è¯**: éœ€è¦ JWT

**å“åº”ç¤ºä¾‹**:

```json
{
  "code": 200,
  "msg": null,
  "data": [
    {
      "id": "0190a1e8-7b3e-7a3f-8c1a-9e2f3a4b5c6d",
      "code": "user",
      "name": "ç”¨æˆ·ç®¡ç†",
      "description": "ç”¨æˆ·ç®¡ç†ç›¸å…³æƒé™",
      "resource_type": "menu",
      "parent_id": null,
      "sort_order": 1,
      "children": [
        {
          "id": "0190b2f9-8c4f-8b4g-9d2b-0f3g4b5c6d7e",
          "code": "user:create",
          "name": "åˆ›å»ºç”¨æˆ·",
          "description": "åˆ›å»ºæ–°ç”¨æˆ·",
          "resource_type": "api",
          "http_method": "POST",
          "resource_path": "/api/v1/users",
          "parent_id": "0190a1e8-7b3e-7a3f-8c1a-9e2f3a4b5c6d",
          "sort_order": 1,
          "children": []
        },
        {
          "id": "0190c3g0-9d5g-9c5h-0e3c-1g4h5c6d7e8f",
          "code": "user:read",
          "name": "æŸ¥çœ‹ç”¨æˆ·",
          "description": "æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨",
          "resource_type": "api",
          "http_method": "GET",
          "resource_path": "/api/v1/users",
          "parent_id": "0190a1e8-7b3e-7a3f-8c1a-9e2f3a4b5c6d",
          "sort_order": 2,
          "children": []
        }
      ]
    }
  ]
}
```

---

### æŸ¥è¯¢æƒé™åˆ—è¡¨

**æ¥å£æè¿°**: åˆ†é¡µæŸ¥è¯¢æƒé™åˆ—è¡¨

**è¯·æ±‚æ–¹å¼**: `GET`

**è¯·æ±‚è·¯å¾„**: `/permissions`

**è®¤è¯**: éœ€è¦ JWT

**æŸ¥è¯¢å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|--------|------|
| page | number | å¦ | 1 | é¡µç  |
| page_size | number | å¦ | 20 | æ¯é¡µæ•°é‡ |
| resource_type | string | å¦ | - | èµ„æºç±»å‹ç­›é€‰ï¼ˆapi/menu/buttonï¼‰ |
| keyword | string | å¦ | - | æƒé™åæˆ–ä»£ç å…³é”®å­—æœç´¢ |

**è¯·æ±‚ç¤ºä¾‹**:

```
GET /guardian-auth/v1/permissions?page=1&page_size=20&resource_type=api
```

---

### åˆ›å»ºæƒé™

**æ¥å£æè¿°**: åˆ›å»ºæ–°çš„æƒé™

**è¯·æ±‚æ–¹å¼**: `POST`

**è¯·æ±‚è·¯å¾„**: `/permissions`

**è®¤è¯**: éœ€è¦ JWT

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|--------|------|
| code | string | æ˜¯ | æƒé™ä»£ç ï¼ˆå”¯ä¸€ï¼‰ |
| name | string | æ˜¯ | æƒé™åç§° |
| description | string | å¦ | æƒé™æè¿° |
| resource_type | string | æ˜¯ | èµ„æºç±»å‹ï¼ˆapi/menu/buttonï¼‰ |
| http_method | string | å¦ | HTTP æ–¹æ³•ï¼ˆGET/POST/PUT/DELETEï¼‰ |
| resource_path | string | å¦ | èµ„æºè·¯å¾„ |
| parent_id | string(UUID) | å¦ | çˆ¶æƒé™ ID |
| sort_order | number | å¦ | æ’åºå­—æ®µ |

**è¯·æ±‚ç¤ºä¾‹**:

```json
{
  "code": "user:update",
  "name": "æ›´æ–°ç”¨æˆ·",
  "description": "æ›´æ–°ç”¨æˆ·ä¿¡æ¯",
  "resource_type": "api",
  "http_method": "PUT",
  "resource_path": "/api/v1/users/:id",
  "parent_id": "0190a1e8-7b3e-7a3f-8c1a-9e2f3a4b5c6d",
  "sort_order": 3
}
```

---

### æ›´æ–°æƒé™

**æ¥å£æè¿°**: æ›´æ–°æƒé™ä¿¡æ¯

**è¯·æ±‚æ–¹å¼**: `PUT`

**è¯·æ±‚è·¯å¾„**: `/permissions/:id`

**è®¤è¯**: éœ€è¦ JWT

---

### åˆ é™¤æƒé™

**æ¥å£æè¿°**: åˆ é™¤æŒ‡å®šçš„æƒé™

**è¯·æ±‚æ–¹å¼**: `DELETE`

**è¯·æ±‚è·¯å¾„**: `/permissions/:id`

**è®¤è¯**: éœ€è¦ JWT

**ä¸šåŠ¡è§„åˆ™**:
- ä¸èƒ½åˆ é™¤ç³»ç»Ÿå†…ç½®æƒé™ï¼ˆ`is_system = true`ï¼‰
- åˆ é™¤æƒé™å‰éœ€è¦ä»è§’è‰²ä¸­ç§»é™¤å…³è”

---

## é”™è¯¯ç 

| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 200 | æ“ä½œæˆåŠŸ |
| 1000 | é€šç”¨ä¸šåŠ¡é”™è¯¯ |
| 1001 | é€šç”¨ç³»ç»Ÿé”™è¯¯ |
| 17000 | ç³»ç»Ÿå†…éƒ¨é”™è¯¯ |
| 17001 | å‚æ•°éªŒè¯å¤±è´¥ |
| 17002 | è®¤è¯å¤±è´¥ |
| 17003 | ä»¤ç‰Œè¿‡æœŸæˆ–æ— æ•ˆ |
| 17004 | æƒé™ä¸è¶³ |
| 17005 | èµ„æºä¸å­˜åœ¨ |
| 17006 | è¯·æ±‚é¢‘ç‡è¿‡é«˜ |
| 17007 | 2FA éªŒè¯å¤±è´¥ |
| 17008 | æ— æ•ˆçš„2FAéªŒè¯ç  |
| 17009 | æœªå¯ç”¨2FA |
| 17010 | å·²å¯ç”¨2FA |

---

## å®‰å…¨è¯´æ˜

### å¯†ç å®‰å…¨
- å¯†ç ä½¿ç”¨ Argon2 å“ˆå¸Œå­˜å‚¨ï¼ˆä¸šç•Œæœ€å®‰å…¨çš„å¯†ç å“ˆå¸Œç®—æ³•ï¼‰
- å¯†ç å¼ºåº¦å»ºè®®ï¼šè‡³å°‘ 8 ä½ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—
- é¦–æ¬¡ç™»å½•åå»ºè®®ä¿®æ”¹é»˜è®¤å¯†ç 

### ä»¤ç‰Œå®‰å…¨
- Access Token æœ‰æ•ˆæœŸçŸ­ï¼ˆ15 åˆ†é’Ÿï¼‰
- Refresh Token æœ‰æ•ˆæœŸé•¿ï¼ˆ7 å¤©ï¼‰
- ä»¤ç‰Œæ³„éœ²åå¯ä»¥é€šè¿‡ç™»å‡ºæ¥å£ä½¿å…¶å¤±æ•ˆ
- å»ºè®®ä½¿ç”¨ HTTPS ä¼ è¾“ä»¤ç‰Œ

### è´¦æˆ·å®‰å…¨
- 5 æ¬¡ç™»å½•å¤±è´¥åé”å®šè´¦æˆ· 15 åˆ†é’Ÿ
- æ”¯æŒç¦ç”¨å’Œå¯ç”¨è´¦æˆ·
- è®°å½•ç™»å½•å¤±è´¥æ¬¡æ•°
- è®°å½•æœ€åç™»å½•æ—¶é—´

### é€Ÿç‡é™åˆ¶
- ç™»å½•æ¥å£æœ‰é¢‘ç‡é™åˆ¶
- å»ºè®®åˆç†çš„é‡è¯•é—´éš”
- è¿‡äºé¢‘ç¹çš„è¯·æ±‚ä¼šè¢«æ‹’ç»ï¼ˆ17006 é”™è¯¯ï¼‰

---

## ç¤ºä¾‹ä»£ç 

### ä½¿ç”¨ cURL

#### ç™»å½•è·å–ä»¤ç‰Œ

```bash
curl -X POST http://localhost:6123/guardian-auth/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "123456"
  }'
```

#### ä½¿ç”¨ä»¤ç‰Œè®¿é—®å—ä¿æŠ¤æ¥å£

```bash
curl -X POST http://localhost:6123/guardian-auth/v1/auth/logout \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -d '{
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }'
```

#### æŸ¥è¯¢ç®¡ç†å‘˜åˆ—è¡¨

> æ³¨æ„ï¼šæ­¤æ¥å£å¾…å®ç°

```bash
curl http://localhost:6123/guardian-auth/v1/admins?page=1&page_size=20 \
  -H "Authorization: Bearer <your_access_token>"
```

---

## é™„å½•

### A. é»˜è®¤è´¦å·

ç³»ç»Ÿåˆå§‹åŒ–åçš„é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼š

```
ç”¨æˆ·å: admin
å¯†ç : 123456
æƒé™: è¶…çº§ç®¡ç†å‘˜ï¼ˆæ‰€æœ‰æƒé™ï¼‰
```

**âš ï¸ é‡è¦æç¤º**: é¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼

### B. çŠ¶æ€ç å¯¹ç…§è¡¨

| ä¸šåŠ¡çŠ¶æ€ | HTTP çŠ¶æ€ | è¯´æ˜ |
|---------|-----------|------|
| æˆåŠŸ | 200 | è¯·æ±‚å¤„ç†æˆåŠŸ |
| ä¸šåŠ¡é”™è¯¯ | 200 | ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼Œcode å­—æ®µåŒ…å«é”™è¯¯ç  |
| å‚æ•°é”™è¯¯ | 200 | è¯·æ±‚å‚æ•°éªŒè¯å¤±è´¥ |
| è®¤è¯é”™è¯¯ | 200 | éœ€è¦ç™»å½•æˆ–ä»¤ç‰Œæ— æ•ˆ |
| æƒé™é”™è¯¯ | 200 | æ²¡æœ‰è¶³å¤Ÿçš„æƒé™ |
| æœåŠ¡å™¨é”™è¯¯ | 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

---

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2026-01-14)
- âœ… å®ç°åŸºç¡€è®¤è¯åŠŸèƒ½ï¼ˆç™»å½•ã€ç™»å‡ºã€åˆ·æ–°ä»¤ç‰Œï¼‰
- âœ… å®ç° 2FA æ¥å£ï¼ˆsetupã€verifyï¼‰
- âœ… å®ç° Argon2 å¯†ç åŠ å¯†
- âœ… å®ç° UUIDv7 ä¸»é”®ï¼ˆå…¨å±€å”¯ä¸€ä¸”æœ‰åºï¼‰
- âœ… å®ç° JWT ä»¤ç‰Œç®¡ç†
- âœ… å®ç°è´¦æˆ·é”å®šæœºåˆ¶
- âœ… å®ç°ä»¤ç‰Œé»‘åå•æœºåˆ¶
- âœ… æ•°æ®åº“è‡ªåŠ¨ç»´æŠ¤ created_at å’Œ updated_at å­—æ®µ
- âœ… æ‰€æœ‰è¡¨åæ·»åŠ  guardian_ å‰ç¼€
- ğŸ“ æ›´æ–° API æ–‡æ¡£ï¼Œä¿®æ­£ç™»å½•æ¥å£å‚æ•°å’Œå“åº”æ ¼å¼
- ğŸ“ æ·»åŠ å®Œæ•´çš„è®¤è¯æ¥å£æ–‡æ¡£ï¼ˆrefreshã€logoutã€2faï¼‰
- ğŸ“ æ ‡è®°æœªå®ç°çš„æ¥å£ï¼ˆç®¡ç†å‘˜ã€è§’è‰²ã€æƒé™ï¼‰
- ğŸ“ ä¿®æ­£æ‰€æœ‰ ID ç±»å‹ä¸º UUID
- ğŸ“ æ–°å¢é”™è¯¯ç  17008ã€17009ã€17010

---
